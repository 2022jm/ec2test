{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"ag-grid-angular\";\nimport * as i2 from \"@angular/common\";\nexport class TableComponent {\n  constructor() {\n    this.rowSelection = 'multiple';\n    this.defaultColDef = {\n      resizable: true\n    };\n  }\n\n  ngOnInit() {\n    this.downloadCsvSubscription = this.exportCsv$.subscribe(data => {\n      // TODO: file names recive the whole object\n      const params = {\n        columnKeys: this.visibleColumns,\n        processCellCallback: params => this.processCells(params)\n      };\n      this.gridApi.exportDataAsCsv(params);\n    });\n    this.visibleColumnsSubscription = this.visibleColumnsAfterUpdate$.subscribe(data => {\n      this.visibleColumns = data;\n    });\n  }\n\n  ngOnDestroy() {\n    this.downloadCsvSubscription.unsubscribe();\n    this.visibleColumnsSubscription.unsubscribe();\n  }\n\n  processCells(params) {\n    const formateDateList = [\"DOB\", \"Date of sampling\"];\n    const posixToYearsList = [\"Age at blood draw\"];\n    const posixToHoursList = [\"Draw Time\", \"Total Processing Time\"]; // get the column name and formate the cell to export csv\n\n    const columnName = params.column.colDef.headerName;\n\n    if (formateDateList.includes(columnName)) {\n      return this.dateFormatter(params);\n    } else if (posixToYearsList.includes(columnName)) {\n      return this.POSIXToYears(params);\n    } else if (posixToHoursList.includes(columnName)) {\n      return this.POSIXToHours(params);\n    }\n\n    return params.value;\n  }\n\n  onGridReady(params) {\n    this.gridApi = params.api;\n    this.gridColumnApi = params.columnApi; // // const allColumnIds: string[] = [];\n    // // this.gridColumnApi.getAllColumns()!.forEach((column) => {\n    // //   allColumnIds.push(column.getId());\n    // // });\n    // // this.gridColumnApi.autoSizeColumns(allColumnIds, false);\n    // // this.gridColumnApi.autoSizeAllColumns();\n\n    this.gridApi.sizeColumnsToFit();\n    this.gridApi.setDomLayout('autoHeight'); // // auto height will get the grid to fill the height of the contents,\n    // // so the grid div should have no height set, the height is dynamic.\n    // // (document.querySelector<HTMLElement>('#myGrid')! as any).style.height = 0;\n    // get column names and delete the first column, because is the select option\n\n    this.visibleColumns = this.gridColumnApi.getAllDisplayedColumns();\n    this.visibleColumns.splice(0, 1);\n  }\n\n  dateFormatter(params) {\n    let date = new Date(params.value);\n    return date.toISOString().substring(0, 10);\n  }\n\n  POSIXToYears(params) {\n    let date = new Date(params.value);\n    let baseDate = new Date(0);\n    return String(date.getFullYear() - baseDate.getFullYear());\n  }\n\n  POSIXToHours(params) {\n    let date = new Date(params.value);\n    return String(date.getHours() + \":\" + date.getMinutes());\n  }\n\n  checkboxSelection(params) {\n    // we put checkbox on the name if we are not doing grouping\n    return params.columnApi.getRowGroupColumns().length === 0;\n  }\n\n  headerCheckboxSelection(params) {\n    // we put checkbox on the name if we are not doing grouping\n    return params.columnApi.getRowGroupColumns().length === 0;\n  }\n\n}\n\nTableComponent.ɵfac = function TableComponent_Factory(t) {\n  return new (t || TableComponent)();\n};\n\nTableComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: TableComponent,\n  selectors: [[\"app-table\"]],\n  inputs: {\n    data$: \"data$\",\n    colDef$: \"colDef$\",\n    exportCsv$: \"exportCsv$\",\n    visibleColumnsAfterUpdate$: \"visibleColumnsAfterUpdate$\"\n  },\n  decls: 3,\n  vars: 10,\n  consts: [[1, \"ag-theme-alpine\", 2, \"width\", \"100%\", \"height\", \"100%\", \"; font-size\", \"12px\", \"box-sizing\", \"border-box\", 3, \"rowData\", \"columnDefs\", \"defaultColDef\", \"pagination\", \"paginationPageSize\", \"rowSelection\", \"gridReady\"]],\n  template: function TableComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"ag-grid-angular\", 0);\n      i0.ɵɵlistener(\"gridReady\", function TableComponent_Template_ag_grid_angular_gridReady_0_listener($event) {\n        return ctx.onGridReady($event);\n      });\n      i0.ɵɵpipe(1, \"async\");\n      i0.ɵɵpipe(2, \"async\");\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"rowData\", i0.ɵɵpipeBind1(1, 6, ctx.data$))(\"columnDefs\", i0.ɵɵpipeBind1(2, 8, ctx.colDef$))(\"defaultColDef\", ctx.defaultColDef)(\"pagination\", true)(\"paginationPageSize\", 5)(\"rowSelection\", ctx.rowSelection);\n    }\n  },\n  dependencies: [i1.AgGridAngular, i2.AsyncPipe],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJ0YWJsZS5jb21wb25lbnQuY3NzIn0= */\"]\n});","map":{"version":3,"mappings":"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","names":["TableComponent","constructor","resizable","ngOnInit","downloadCsvSubscription","exportCsv$","subscribe","data","params","columnKeys","visibleColumns","processCellCallback","processCells","gridApi","exportDataAsCsv","visibleColumnsSubscription","visibleColumnsAfterUpdate$","ngOnDestroy","unsubscribe","formateDateList","posixToYearsList","posixToHoursList","columnName","column","colDef","headerName","includes","dateFormatter","POSIXToYears","POSIXToHours","value","onGridReady","api","gridColumnApi","columnApi","sizeColumnsToFit","setDomLayout","getAllDisplayedColumns","splice","date","Date","toISOString","substring","baseDate","String","getFullYear","getHours","getMinutes","checkboxSelection","getRowGroupColumns","length","headerCheckboxSelection","selectors","inputs","data$","colDef$","decls","vars","consts","template","i0","ctx"],"sourceRoot":"","sources":["D:\\System\\Desktop\\UPF\\4 Cuarto año\\Tercer Trimestre\\TFG\\stalicla-explorer\\src\\app\\browse\\components\\table\\table.component.ts","D:\\System\\Desktop\\UPF\\4 Cuarto año\\Tercer Trimestre\\TFG\\stalicla-explorer\\src\\app\\browse\\components\\table\\table.component.html"],"sourcesContent":["import { Component, OnInit, Input } from '@angular/core';\r\nimport { Observable, Subscription } from 'rxjs';\r\nimport {\r\n  ColDef,\r\n  ColumnApi,\r\n  ColumnResizedEvent,\r\n  CsvExportParams,\r\n  GridApi,\r\n  GridReadyEvent,\r\n} from 'ag-grid-community';\r\n\r\n@Component({\r\n  selector: 'app-table',\r\n  templateUrl: './table.component.html',\r\n  styleUrls: ['./table.component.css']\r\n})\r\nexport class TableComponent implements OnInit {\r\n\r\n\r\n  @Input() data$: Observable<any>;\r\n  @Input() colDef$: Observable<ColDef[]>;\r\n  @Input() exportCsv$: Observable<boolean>;\r\n  @Input() visibleColumnsAfterUpdate$: Observable<any>;\r\n\r\n  private gridApi!: GridApi;\r\n  private gridColumnApi!: ColumnApi;\r\n  public rowSelection = 'multiple';\r\n  public defaultColDef: ColDef = {\r\n    resizable: true,\r\n  }\r\n  \r\n  private downloadCsvSubscription: Subscription;\r\n  private visibleColumnsSubscription: Subscription;\r\n  private visibleColumns;\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit(): void {\r\n    this.downloadCsvSubscription = this.exportCsv$.subscribe(data => {\r\n      // TODO: file names recive the whole object\r\n      const params:CsvExportParams = {\r\n        columnKeys: this.visibleColumns,\r\n        processCellCallback: (params: any): string => this.processCells(params)\r\n      }\r\n      this.gridApi.exportDataAsCsv(params);\r\n    });\r\n    this.visibleColumnsSubscription = this.visibleColumnsAfterUpdate$.subscribe(data => {\r\n      this.visibleColumns = data;\r\n    })\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.downloadCsvSubscription.unsubscribe();\r\n    this.visibleColumnsSubscription.unsubscribe();\r\n  }\r\n\r\n  processCells(params: any): string {\r\n    const formateDateList: string[] = [\"DOB\", \"Date of sampling\"];\r\n    const posixToYearsList: string[] = [\"Age at blood draw\"];\r\n    const posixToHoursList: string[] = [\"Draw Time\", \"Total Processing Time\"];\r\n    // get the column name and formate the cell to export csv\r\n    const columnName:string = params.column.colDef.headerName;\r\n    \r\n    if (formateDateList.includes(columnName)) {\r\n      return this.dateFormatter(params);\r\n    } else if (posixToYearsList.includes(columnName)) {\r\n      return this.POSIXToYears(params);\r\n    } else if(posixToHoursList.includes(columnName)) {\r\n      return this.POSIXToHours(params);\r\n    }\r\n\r\n    return params.value;\r\n  }\r\n\r\n  onGridReady(params: GridReadyEvent) {\r\n    this.gridApi = params.api;\r\n    this.gridColumnApi = params.columnApi;\r\n    \r\n    \r\n    \r\n    // // const allColumnIds: string[] = [];\r\n    // // this.gridColumnApi.getAllColumns()!.forEach((column) => {\r\n      // //   allColumnIds.push(column.getId());\r\n      // // });\r\n      // // this.gridColumnApi.autoSizeColumns(allColumnIds, false);\r\n      \r\n      // // this.gridColumnApi.autoSizeAllColumns();\r\n    this.gridApi.sizeColumnsToFit();\r\n    \r\n    this.gridApi.setDomLayout('autoHeight');\r\n\r\n      // // auto height will get the grid to fill the height of the contents,\r\n      // // so the grid div should have no height set, the height is dynamic.\r\n      // // (document.querySelector<HTMLElement>('#myGrid')! as any).style.height = 0;\r\n      \r\n    // get column names and delete the first column, because is the select option\r\n\r\n    this.visibleColumns = this.gridColumnApi.getAllDisplayedColumns();\r\n    this.visibleColumns.splice(0, 1);\r\n\r\n  }\r\n\r\n  private dateFormatter(params) {\r\n    let date = new Date(params.value);\r\n    return date.toISOString().substring(0, 10)\r\n  }\r\n\r\n  private POSIXToYears(params) {\r\n    let date = new Date(params.value);\r\n    let baseDate = new Date(0);\r\n    return String(date.getFullYear() - baseDate.getFullYear());\r\n  }\r\n\r\n  private POSIXToHours(params) {\r\n    let date = new Date(params.value);\r\n    return String(date.getHours() + \":\" + date.getMinutes());\r\n  }\r\n\r\n  private checkboxSelection(params) {\r\n    // we put checkbox on the name if we are not doing grouping\r\n    return params.columnApi.getRowGroupColumns().length === 0;\r\n  };\r\n\r\n  private headerCheckboxSelection(params) {\r\n    // we put checkbox on the name if we are not doing grouping\r\n    return params.columnApi.getRowGroupColumns().length === 0;\r\n  };\r\n\r\n}\r\n","<!-- TODO: change the height to 260px; -->\r\n<ag-grid-angular\r\n    style=\"width: 100%; height: 100%;; font-size: 12px; box-sizing: border-box;\"\r\n    class=\"ag-theme-alpine\"\r\n    [rowData]=\"data$ | async\"\r\n    [columnDefs]=\"colDef$ | async\"\r\n    [defaultColDef]=\"defaultColDef\"\r\n    [pagination]=\"true\"\r\n    [paginationPageSize]=\"5\"\r\n    [rowSelection]='rowSelection'\r\n    (gridReady)=\"onGridReady($event)\"\r\n    >\r\n</ag-grid-angular>"]},"metadata":{},"sourceType":"module"}