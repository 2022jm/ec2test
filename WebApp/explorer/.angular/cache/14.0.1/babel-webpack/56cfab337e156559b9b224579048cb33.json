{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"ag-grid-angular\";\nimport * as i2 from \"@angular/common\";\nexport class TableComponent {\n  constructor() {\n    this.rowSelection = 'multiple';\n    this.defaultColDef = {\n      resizable: true,\n      filter: true,\n      sortable: true,\n      pagination: true,\n      paginationPageSize: 5\n    };\n  }\n\n  ngOnInit() {\n    this.downloadCsvSubscription = this.exportCsv$.subscribe(data => {\n      // TODO: file names recive the whole object\n      const params = {\n        columnKeys: this.visibleColumns,\n        processCellCallback: params => this.processCells(params)\n      };\n      this.gridApi.exportDataAsCsv(params);\n    });\n  }\n\n  ngOnDestroy() {\n    this.downloadCsvSubscription.unsubscribe();\n    this.visibleColumnsSubscription.unsubscribe();\n  }\n\n  processCells(params) {\n    const formateDateList = [\"DOB\", \"Date of sampling\"];\n    const posixToYearsList = [\"Age at blood draw\"];\n    const posixToHoursList = [\"Draw Time\", \"Total Processing Time\"]; // get the column name and formate the cell to export csv\n\n    const columnName = params.column.colDef.headerName;\n\n    if (formateDateList.includes(columnName)) {\n      return this.dateFormatter(params);\n    } else if (posixToYearsList.includes(columnName)) {\n      return this.POSIXToYears(params);\n    } else if (posixToHoursList.includes(columnName)) {\n      return this.POSIXToHours(params);\n    }\n\n    return params.value;\n  }\n\n  onGridReady(params) {\n    this.gridApi = params.api;\n    this.gridColumnApi = params.columnApi; // set the columns to fit in the table\n\n    this.gridApi.sizeColumnsToFit();\n    this.gridApi.setDomLayout('autoHeight'); // this subscription updates the columns to hide or show\n\n    this.visibleColumnsSubscription = this.visibleColumnsAfterUpdate$.subscribe(data => {\n      this.visibleColumns = data;\n\n      for (let col of this.visibleColumns) {\n        const column = this.gridColumnApi.getAllColumns().find(x => x.getColDef().headerName == col.name);\n        this.gridColumnApi.setColumnVisible(column, col.visible);\n      } // resize columns width to fit in the table\n\n\n      this.gridApi.sizeColumnsToFit();\n    });\n    console.log(\"Current page: \", this.gridApi.paginationGetCurrentPage());\n    console.log(\"Total number of pages: \", this.gridApi.paginationGetTotalPages());\n    console.log(\"Page size: \", this.gridApi.paginationGetPageSize());\n  }\n\n  dateFormatter(params) {\n    let date = new Date(params.value);\n    return date.toISOString().substring(0, 10);\n  }\n\n  POSIXToYears(params) {\n    let date = new Date(params.value);\n    let baseDate = new Date(0);\n    return String(date.getFullYear() - baseDate.getFullYear());\n  }\n\n  POSIXToHours(params) {\n    let date = new Date(params.value);\n    return String(date.getHours() + \":\" + date.getMinutes());\n  }\n\n  checkboxSelection(params) {\n    // we put checkbox on the name if we are not doing grouping\n    return params.columnApi.getRowGroupColumns().length === 0;\n  }\n\n  headerCheckboxSelection(params) {\n    // we put checkbox on the name if we are not doing grouping\n    return params.columnApi.getRowGroupColumns().length === 0;\n  }\n\n}\n\nTableComponent.ɵfac = function TableComponent_Factory(t) {\n  return new (t || TableComponent)();\n};\n\nTableComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: TableComponent,\n  selectors: [[\"app-table\"]],\n  inputs: {\n    data$: \"data$\",\n    colDef$: \"colDef$\",\n    exportCsv$: \"exportCsv$\",\n    visibleColumnsAfterUpdate$: \"visibleColumnsAfterUpdate$\"\n  },\n  decls: 3,\n  vars: 9,\n  consts: [[1, \"ag-theme-alpine\", 2, \"width\", \"100%\", \"height\", \"100%\", \"; font-size\", \"12px\", \"box-sizing\", \"border-box\", 3, \"rowData\", \"columnDefs\", \"defaultColDef\", \"suppressDragLeaveHidesColumns\", \"rowSelection\", \"gridReady\"]],\n  template: function TableComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"ag-grid-angular\", 0);\n      i0.ɵɵlistener(\"gridReady\", function TableComponent_Template_ag_grid_angular_gridReady_0_listener($event) {\n        return ctx.onGridReady($event);\n      });\n      i0.ɵɵpipe(1, \"async\");\n      i0.ɵɵpipe(2, \"async\");\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"rowData\", i0.ɵɵpipeBind1(1, 5, ctx.data$))(\"columnDefs\", i0.ɵɵpipeBind1(2, 7, ctx.colDef$))(\"defaultColDef\", ctx.defaultColDef)(\"suppressDragLeaveHidesColumns\", true)(\"rowSelection\", ctx.rowSelection);\n    }\n  },\n  dependencies: [i1.AgGridAngular, i2.AsyncPipe],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJ0YWJsZS5jb21wb25lbnQuY3NzIn0= */\"]\n});","map":{"version":3,"mappings":"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","names":["TableComponent","constructor","resizable","filter","sortable","pagination","paginationPageSize","ngOnInit","downloadCsvSubscription","exportCsv$","subscribe","data","params","columnKeys","visibleColumns","processCellCallback","processCells","gridApi","exportDataAsCsv","ngOnDestroy","unsubscribe","visibleColumnsSubscription","formateDateList","posixToYearsList","posixToHoursList","columnName","column","colDef","headerName","includes","dateFormatter","POSIXToYears","POSIXToHours","value","onGridReady","api","gridColumnApi","columnApi","sizeColumnsToFit","setDomLayout","visibleColumnsAfterUpdate$","col","getAllColumns","find","x","getColDef","name","setColumnVisible","visible","console","log","paginationGetCurrentPage","paginationGetTotalPages","paginationGetPageSize","date","Date","toISOString","substring","baseDate","String","getFullYear","getHours","getMinutes","checkboxSelection","getRowGroupColumns","length","headerCheckboxSelection","selectors","inputs","data$","colDef$","decls","vars","consts","template","i0","ctx"],"sourceRoot":"","sources":["D:\\System\\Desktop\\UPF\\4 Cuarto año\\Tercer Trimestre\\TFG\\stalicla-explorer\\src\\app\\browse\\components\\table\\table.component.ts","D:\\System\\Desktop\\UPF\\4 Cuarto año\\Tercer Trimestre\\TFG\\stalicla-explorer\\src\\app\\browse\\components\\table\\table.component.html"],"sourcesContent":["import { Component, OnInit, Input } from '@angular/core';\r\nimport { Observable, Subscription } from 'rxjs';\r\nimport {\r\n  ColDef,\r\n  ColumnApi,\r\n  ColumnResizedEvent,\r\n  CsvExportParams,\r\n  GridApi,\r\n  GridReadyEvent,\r\n} from 'ag-grid-community';\r\n\r\n@Component({\r\n  selector: 'app-table',\r\n  templateUrl: './table.component.html',\r\n  styleUrls: ['./table.component.css']\r\n})\r\nexport class TableComponent implements OnInit {\r\n\r\n\r\n  @Input() data$: Observable<any>;\r\n  @Input() colDef$: Observable<ColDef[]>;\r\n  @Input() exportCsv$: Observable<boolean>;\r\n  @Input() visibleColumnsAfterUpdate$: Observable<any>;\r\n\r\n  private gridApi!: GridApi;\r\n  private gridColumnApi!: ColumnApi;\r\n  public rowSelection = 'multiple';\r\n  public defaultColDef: ColDef = {\r\n    resizable: true,\r\n    filter: true,\r\n    sortable: true,\r\n    pagination: true,\r\n    paginationPageSize: 5,\r\n  }\r\n  \r\n  private downloadCsvSubscription: Subscription;\r\n  private visibleColumnsSubscription: Subscription;\r\n  private visibleColumns;\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit(): void {\r\n    this.downloadCsvSubscription = this.exportCsv$.subscribe(data => {\r\n      // TODO: file names recive the whole object\r\n      const params:CsvExportParams = {\r\n        columnKeys: this.visibleColumns,\r\n        processCellCallback: (params: any): string => this.processCells(params)\r\n      }\r\n      this.gridApi.exportDataAsCsv(params);\r\n    });\r\n    \r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.downloadCsvSubscription.unsubscribe();\r\n    this.visibleColumnsSubscription.unsubscribe();\r\n  }\r\n\r\n  processCells(params: any): string {\r\n    const formateDateList: string[] = [\"DOB\", \"Date of sampling\"];\r\n    const posixToYearsList: string[] = [\"Age at blood draw\"];\r\n    const posixToHoursList: string[] = [\"Draw Time\", \"Total Processing Time\"];\r\n    // get the column name and formate the cell to export csv\r\n    const columnName:string = params.column.colDef.headerName;\r\n    \r\n    if (formateDateList.includes(columnName)) {\r\n      return this.dateFormatter(params);\r\n    } else if (posixToYearsList.includes(columnName)) {\r\n      return this.POSIXToYears(params);\r\n    } else if(posixToHoursList.includes(columnName)) {\r\n      return this.POSIXToHours(params);\r\n    }\r\n\r\n    return params.value;\r\n  }\r\n\r\n  onGridReady(params: GridReadyEvent) {\r\n    this.gridApi = params.api;\r\n    this.gridColumnApi = params.columnApi;\r\n    \r\n    // set the columns to fit in the table\r\n    this.gridApi.sizeColumnsToFit();\r\n    this.gridApi.setDomLayout('autoHeight');\r\n\r\n    // this subscription updates the columns to hide or show\r\n    this.visibleColumnsSubscription = this.visibleColumnsAfterUpdate$.subscribe(data => {\r\n      this.visibleColumns = data;\r\n      for (let col of this.visibleColumns) {\r\n        const column = (this.gridColumnApi.getAllColumns()!.find(x => x.getColDef().headerName == col.name));\r\n        this.gridColumnApi.setColumnVisible(column!, col.visible);\r\n      }\r\n      // resize columns width to fit in the table\r\n      this.gridApi.sizeColumnsToFit();\r\n    })\r\n\r\n    console.log(\"Current page: \", this.gridApi.paginationGetCurrentPage());\r\n    console.log(\"Total number of pages: \", this.gridApi.paginationGetTotalPages());\r\n    console.log(\"Page size: \",this.gridApi.paginationGetPageSize());\r\n  }\r\n\r\n  private dateFormatter(params) {\r\n    let date = new Date(params.value);\r\n    return date.toISOString().substring(0, 10)\r\n  }\r\n\r\n  private POSIXToYears(params) {\r\n    let date = new Date(params.value);\r\n    let baseDate = new Date(0);\r\n    return String(date.getFullYear() - baseDate.getFullYear());\r\n  }\r\n\r\n  private POSIXToHours(params) {\r\n    let date = new Date(params.value);\r\n    return String(date.getHours() + \":\" + date.getMinutes());\r\n  }\r\n\r\n  private checkboxSelection(params) {\r\n    // we put checkbox on the name if we are not doing grouping\r\n    return params.columnApi.getRowGroupColumns().length === 0;\r\n  };\r\n\r\n  private headerCheckboxSelection(params) {\r\n    // we put checkbox on the name if we are not doing grouping\r\n    return params.columnApi.getRowGroupColumns().length === 0;\r\n  };\r\n\r\n}\r\n","<!-- TODO: change the height to 260px; -->\r\n<ag-grid-angular\r\n    style=\"width: 100%; height: 100%;; font-size: 12px; box-sizing: border-box;\"\r\n    class=\"ag-theme-alpine\"\r\n    [rowData]=\"data$ | async\"\r\n    [columnDefs]=\"colDef$ | async\"\r\n    [defaultColDef]=\"defaultColDef\"\r\n    [suppressDragLeaveHidesColumns]=\"true\"\r\n    [rowSelection]='rowSelection'\r\n    (gridReady)=\"onGridReady($event)\"\r\n    >\r\n</ag-grid-angular>"]},"metadata":{},"sourceType":"module"}